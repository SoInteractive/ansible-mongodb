---
- name: Configuring directories
  file:
    state: directory
    path: "{{ item }}"
    owner: "{{ mongodb_system_user }}"
    group: "{{ mongodb_system_group }}"
    mode: 0755
  with_items:
    - "{{ mongodb_database_dir }}"
    - "{{ mongodb_log_dir }}"

# TODO remove locale?
- name: Set default locale
  lineinfile:
    dest: /etc/default/locale
    regexp: "LC_ALL"
    line: 'LC_ALL="en_US.UTF-8"'

- name: Update locale
  command: update-locale LC_ALL=en_US.UTF-8

- name: Create default configuration
  template:
    src: mongod.conf.j2
    dest: /etc/mongod.conf
  notify: mongodb restart

- name: Create keyfile
  template:
    src: keyfile.j2
    dest: "{{ mongodb_security_keyfile }}"
  when: mongodb_security_keyfile != None

- name: Start mongodb
  service:
    name: mongod
    state: started
    enabled: yes

