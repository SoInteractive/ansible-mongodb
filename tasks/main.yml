---
- name: Gather variables for each operating system
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_version | lower }}.yml"
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_os_family | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution | lower }}.yml"
    - "{{ ansible_os_family | lower }}.yml"
  tags:
    - always

- block:
    - include: configure_container.yml
    - include: install_container.yml
    #    - include: auth_method_container.yml
    - include: users_container.yml
  run_once: true
  when: mongodb_method_install != 'binary'

# - block:
#     - include: install.yml
#     - include: configure.yml
#     - include: users.yml
#   when: mongodb_method_install == 'binary'

#- include: auth_method.yml
##  run_once: true
##  delegate_to: "{{ mongodb_main_node }}"
#  when:
#    - mongodb_authentication != "SCRAM-SHA-1"
#    - not mongod_config.stat.exists

#- include: replica.yml
#  when: mongodb_replica_name != None and groups[mongodb_hosts_group] | length > 2
#  run_once: true
#  delegate_to: "{{ groups[mongodb_hosts_group][0] }}"

#- include: users_container.yml
#  run_once: true
#  delegate_to: "{{ groups[mongodb_hosts_group][0] }}"

#- include: security_container.yml

#- include: metrics.yml
#  when: mongodb_metrics
